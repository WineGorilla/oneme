<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Oneme AI 助手</title>
</head>
<body>
  <h1>模型加载完成！</h1>
  <div id="status"></div>
  <div>
    <p>识别内容：<span id="input-text"></span></p>
    <p>AI 回复：<span id="reply-text"></span></p>
  </div>

  <script>

let isRecording = false;

document.addEventListener("keydown", async (e) => {
  if (e.code === "Backquote" && !isRecording) {
    isRecording = true;

    document.getElementById('status').innerText = "正在录音";
    await fetch("http://127.0.0.1:5005/start_record", {
      method: "POST"
    });
  }
});

document.addEventListener("keyup", async (e) => {
  if (e.code === "Backquote" && isRecording) {
    isRecording = false;

    document.getElementById('status').innerText = "正在处理";
    const res = await fetch("http://127.0.0.1:5005/stop_record", {
      method: "POST"
    });

    const data = await res.json();
    document.getElementById('status').innerText = "完成!";
    document.getElementById('input-text').innerText = data.input;
    document.getElementById('reply-text').innerText = data.reply;

    // 播放音频（最新版本）
    const audioRes = await fetch(data.audio_url);
    const audioBlob = await audioRes.blob();
    const audioURL = URL.createObjectURL(audioBlob);
    const audio = new Audio(audioURL);
    audio.play();
  }
});
</script>

  </script>
</body>
</html>
